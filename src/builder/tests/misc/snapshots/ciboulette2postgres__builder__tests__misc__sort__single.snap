---
source: src/builder/tests/misc/sort.rs
expression: "sqlformat::format(query.as_str(), &sqlformat::QueryParams::None,\n                  sqlformat::FormatOptions::default())"

---
WITH "cte_peoples_data" AS (
  SELECT
    "public"."peoples"."id" :: TEXT AS "id",
    "public"."peoples"."id" AS "main_id",
    $1 :: TEXT AS "type",
    JSON_BUILD_OBJECT(
      $2,
      "public"."peoples"."age",
      $3,
      "public"."peoples"."first-name",
      $4,
      "public"."peoples"."gender",
      $5,
      "public"."peoples"."last-name",
      $6,
      "public"."peoples"."twitter"
    ) AS "data",
    NULL :: TEXT AS "related_id",
    NULL :: TEXT AS "related_type",
    "public"."peoples"."favorite_color" AS "rel_favorite_color"
  FROM
    "public"."peoples"
),
"cte_favorite_color_data" AS (
  SELECT
    "public"."favorite_color"."id" :: TEXT AS "id",
    "public"."favorite_color"."id" AS "main_id",
    $7 :: TEXT AS "type",
    NULL :: json AS "data",
    "cte_peoples_data"."id" :: TEXT AS "related_id",
    $8 :: TEXT AS "related_type",
    "public"."favorite_color"."color" AS "sort_color"
  FROM
    "public"."favorite_color"
    INNER JOIN "cte_peoples_data" ON "public"."favorite_color"."id" = "cte_peoples_data"."rel_favorite_color"
)(
  SELECT
    "cte_peoples_data"."id",
    "cte_peoples_data"."type",
    "cte_peoples_data"."data",
    "cte_peoples_data"."related_type",
    "cte_peoples_data"."related_id"
  FROM
    "cte_peoples_data"
    LEFT JOIN "public"."peoples" ON "public"."peoples"."id" = "cte_peoples_data"."main_id"
    LEFT JOIN "cte_favorite_color_data" ON "cte_favorite_color_data"."main_id" = "public"."peoples"."favorite_color"
  ORDER BY
    "cte_favorite_color_data"."sort_color" ASC
);
